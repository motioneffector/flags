<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>@motioneffector/flags - Interactive Demo</title>
  <link rel="stylesheet" href="demo-files/demo.css">
</head>
<body>
  <div class="page">
    <header class="header">
      <h1 class="header-title">@motioneffector/flags</h1>
      <p class="header-description">A TypeScript library for managing application state with powerful condition evaluation and reactive subscriptions.</p>
      <nav class="header-links">
        <a href="https://www.npmjs.com/package/@motioneffector/flags" class="header-link" target="_blank">
          <span>üì¶</span> npm
        </a>
        <a href="https://github.com/motioneffector/flags" class="header-link" target="_blank">
          <span>üíª</span> GitHub
        </a>
        <a href="manual/index.html" class="header-link">
          <span>üìñ</span> Manual
        </a>
      </nav>
    </header>

    <main>
      <!-- Test Runner (FIRST) -->
      <section class="test-runner" id="test-runner">
        <div class="test-runner-header">
          <h2 class="test-runner-title">Test Runner</h2>
        </div>
        <div class="test-runner-content">
          <!-- Control bar: progress bar + buttons, above output console -->
          <div class="test-control-bar">
            <div class="test-progress">
              <div class="test-progress-bar">
                <div class="test-progress-fill" id="progress-fill"></div>
              </div>
              <div class="test-progress-text" id="progress-text">Ready</div>
            </div>
            <div class="test-runner-actions">
              <button class="btn btn-primary" id="run-all-tests">
                <span class="btn-icon">‚ñ∂</span>
                <span>Run All Tests</span>
              </button>
              <button class="btn btn-secondary" id="reset-page">
                <span class="btn-icon">‚Üª</span>
                <span>Reset Page</span>
              </button>
            </div>
          </div>
          <!-- Output console below the control bar -->
          <div class="test-output" id="test-output">
            <div class="test-output-placeholder">Click "Run All Tests" to execute the test suite and see a live demonstration</div>
          </div>
          <div class="test-summary hidden" id="test-summary"></div>
        </div>
      </section>

      <!-- Exhibit 1: Game State Dashboard -->
      <section class="exhibit" id="exhibit-1">
        <div class="exhibit-header">
          <h2 class="exhibit-title">Game State Dashboard</h2>
          <p class="exhibit-description">Direct manipulation of flag values. Click, drag, and tap to change state - watch everything react in real-time.</p>
        </div>
        <div class="exhibit-content">
          <!-- Preset Scenarios -->
          <div class="scenario-buttons">
            <span class="scenario-label">Load a scenario:</span>
            <button class="btn btn-secondary btn-small" data-scenario="fresh">üÜï Fresh Start</button>
            <button class="btn btn-secondary btn-small" data-scenario="danger">üíÄ Near Death</button>
            <button class="btn btn-secondary btn-small" data-scenario="rich">üí∞ Rich Merchant</button>
            <button class="btn btn-secondary btn-small" data-scenario="battle">‚öîÔ∏è Battle Ready</button>
          </div>

          <div class="exhibit-interactive" id="game-dashboard">
            <!-- Player Stats -->
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-header">
                  <span class="stat-icon">‚ù§Ô∏è</span>
                  <span class="stat-label">HEALTH</span>
                  <span class="stat-value" id="health-value">75</span>
                </div>
                <div class="stat-bar-container" id="health-bar-container">
                  <div class="stat-bar health-bar" id="health-bar" style="width: 75%"></div>
                </div>
                <div class="stat-hint">Click bar to set health</div>
              </div>

              <div class="stat-card">
                <div class="stat-header">
                  <span class="stat-icon">üí∞</span>
                  <span class="stat-label">GOLD</span>
                  <span class="stat-value" id="gold-value">150</span>
                </div>
                <div class="stat-bar-container" id="gold-bar-container">
                  <div class="stat-bar gold-bar" id="gold-bar" style="width: 15%"></div>
                </div>
                <div class="stat-hint">Drag to adjust gold (0-1000)</div>
              </div>

              <div class="stat-card">
                <div class="stat-header">
                  <span class="stat-icon">‚≠ê</span>
                  <span class="stat-label">LEVEL</span>
                  <span class="stat-value level-badge" id="level-value">5</span>
                </div>
                <button class="btn btn-secondary level-up-btn" id="level-up-btn">Level Up!</button>
                <div class="stat-hint">Click to level up</div>
              </div>

              <div class="stat-card">
                <div class="stat-header">
                  <span class="stat-icon">üìä</span>
                  <span class="stat-label">REPUTATION</span>
                  <span class="stat-value" id="reputation-value">80</span>
                </div>
                <div class="stat-bar-container" id="reputation-bar-container">
                  <div class="stat-bar reputation-bar" id="reputation-bar" style="width: 80%"></div>
                </div>
                <div class="stat-hint">Click bar to set reputation</div>
              </div>
            </div>

            <!-- Inventory -->
            <div class="inventory-section">
              <h3 class="section-title">Inventory</h3>
              <div class="inventory-grid">
                <div class="item-card" data-item="sword">
                  <span class="item-icon">‚öîÔ∏è</span>
                  <span class="item-name">Sword</span>
                  <span class="item-weight">3kg</span>
                  <div class="item-status equipped">Equipped</div>
                </div>
                <div class="item-card" data-item="shield">
                  <span class="item-icon">üõ°Ô∏è</span>
                  <span class="item-name">Shield</span>
                  <span class="item-weight">5kg</span>
                  <div class="item-status">Unequipped</div>
                </div>
                <div class="item-card" data-item="key">
                  <span class="item-icon">üîë</span>
                  <span class="item-name">Key</span>
                  <span class="item-weight">1kg</span>
                  <div class="item-status equipped">Equipped</div>
                </div>
                <div class="item-card" data-item="potion">
                  <span class="item-icon">üß™</span>
                  <span class="item-name">Potion</span>
                  <span class="item-weight">1kg</span>
                  <div class="item-status">Unequipped</div>
                </div>
              </div>
              <div class="weight-display">
                <span class="weight-label">Weight:</span>
                <div class="weight-bar-container">
                  <div class="weight-bar" id="weight-bar" style="width: 40%"></div>
                </div>
                <span class="weight-value" id="weight-value">4/10 kg</span>
              </div>
            </div>

            <!-- Status Effects -->
            <div class="status-section">
              <h3 class="section-title">Status Effects</h3>
              <div class="status-grid">
                <div class="status-card active" data-status="healthy">
                  <span class="status-icon">üü¢</span>
                  <span class="status-name">Healthy</span>
                </div>
                <div class="status-card" data-status="poisoned">
                  <span class="status-icon">‚ò†Ô∏è</span>
                  <span class="status-name">Poisoned</span>
                </div>
                <div class="status-card" data-status="blessed">
                  <span class="status-icon">‚ú®</span>
                  <span class="status-name">Blessed</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Raw State Display -->
          <div class="exhibit-state">
            <div class="exhibit-state-header">
              <div class="exhibit-state-title">Raw Flag State (live)</div>
              <button class="btn btn-small btn-secondary" id="toggle-state">Collapse</button>
            </div>
            <pre class="state-display" id="raw-state"></pre>
          </div>
        </div>
      </section>

      <!-- Exhibit 2: Live Condition Cards -->
      <section class="exhibit" id="exhibit-2">
        <div class="exhibit-header">
          <h2 class="exhibit-title">Live Condition Cards</h2>
          <p class="exhibit-description">Watch conditions evaluate in real-time as you change the game state above. See exactly WHY each condition passes or fails.</p>
        </div>
        <div class="exhibit-content">
          <div class="exhibit-interactive" id="condition-cards">
            <div class="conditions-grid" id="conditions-grid">
              <!-- Condition cards will be rendered here -->
            </div>
            <button class="btn btn-primary" id="add-condition-btn">+ Add Condition</button>
          </div>
        </div>
      </section>

      <!-- Exhibit 3: Time Machine -->
      <section class="exhibit" id="exhibit-3">
        <div class="exhibit-header">
          <h2 class="exhibit-title">Time Machine</h2>
          <p class="exhibit-description">Undo/redo with visible state animation. Click any point on the timeline to travel back in time.</p>
        </div>
        <div class="exhibit-content">
          <div class="exhibit-interactive" id="time-machine">
            <!-- Timeline -->
            <div class="timeline-section">
              <h3 class="section-title">History Timeline</h3>
              <div class="timeline-container" id="timeline-container">
                <div class="timeline-track" id="timeline-track">
                  <!-- Timeline dots rendered here -->
                </div>
              </div>
              <div class="timeline-controls">
                <button class="btn btn-secondary" id="undo-btn" disabled>‚óÄ‚óÄ Undo</button>
                <button class="btn btn-secondary" id="redo-btn" disabled>Redo ‚ñ∂‚ñ∂</button>
                <button class="btn btn-danger btn-small" id="clear-history-btn">üóëÔ∏è Clear History</button>
              </div>
            </div>

            <!-- Batch Demo -->
            <div class="batch-section">
              <h3 class="section-title">Batch Operations Demo</h3>
              <p class="batch-description">See how batching affects undo history:</p>
              <div class="batch-buttons">
                <div class="batch-option">
                  <button class="btn btn-secondary" id="make-3-changes">Make 3 Changes</button>
                  <div class="batch-hint">Creates 3 dots - 3 undos to revert</div>
                </div>
                <div class="batch-option">
                  <button class="btn btn-primary" id="make-batch-3">Make Batch of 3</button>
                  <div class="batch-hint">Creates 1 dot - 1 undo to revert all</div>
                </div>
              </div>
            </div>

            <!-- Persistence -->
            <div class="persistence-section">
              <h3 class="section-title">Persistence</h3>
              <div class="persistence-buttons">
                <button class="btn btn-secondary" id="save-btn">üíæ Save to Storage</button>
                <button class="btn btn-secondary" id="load-btn">üìÇ Load from Storage</button>
              </div>
              <div class="persistence-status" id="persistence-status">Ready</div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Add Condition Modal -->
  <div class="modal-overlay hidden" id="condition-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add a Condition</h3>
        <button class="modal-close" id="close-modal">&times;</button>
      </div>
      <div class="modal-content">
        <div class="template-section">
          <h4>Quick Templates (click to add):</h4>
          <div class="templates-list">
            <button class="template-btn" data-condition="inventory.has_potion AND player.health < 50" data-name="Can use healing potion">
              <strong>"Can use healing potion"</strong>
              <code>has_potion AND health &lt; 50</code>
            </button>
            <button class="template-btn" data-condition="player.level >= 10 AND inventory.has_sword AND inventory.has_shield" data-name="Boss fight ready">
              <strong>"Boss fight ready"</strong>
              <code>level &gt;= 10 AND has_sword AND has_shield</code>
            </button>
            <button class="template-btn" data-condition="player.gold >= 100 AND (NOT inventory.has_potion OR NOT inventory.has_shield)" data-name="Needs shopping">
              <strong>"Needs shopping"</strong>
              <code>gold &gt;= 100 AND (NOT has_potion OR NOT has_shield)</code>
            </button>
            <button class="template-btn" data-condition="player.health < 25 OR status.poisoned" data-name="In danger">
              <strong>"In danger"</strong>
              <code>health &lt; 25 OR poisoned</code>
            </button>
          </div>
        </div>
        <div class="custom-section">
          <h4>Or build your own:</h4>
          <input type="text" class="input input-mono" id="custom-condition-name" placeholder="Condition name...">
          <input type="text" class="input input-mono" id="custom-condition" placeholder="e.g., player.gold >= 100 AND inventory.has_key">
          <button class="btn btn-primary" id="add-custom-condition">Add Condition</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Library (from dist) -->
  <script type="module">
    import * as Library from './dist/index.js'
    window.Library = Library
  </script>

  <!-- Demo scripts (order matters) -->
  <script src="demo-files/test-runner.js"></script>
  <script src="demo-files/demo.js"></script>
  <script src="demo-files/tests.js"></script>
</body>
</html>
